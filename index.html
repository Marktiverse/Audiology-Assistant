<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>督導戰情室：賦能顧問版</title>

  <!-- UI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
    body { font-family: 'Noto Sans TC', sans-serif; }
    .btn { transition: all .2s ease; }
    .btn:active { transform: scale(0.98); }
    .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025); }
    .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>

<body class="bg-indigo-50/30 min-h-screen">
  <div class="max-w-5xl mx-auto px-4 py-8">

    <!-- Header -->
    <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
      <div>
        <h1 class="text-2xl font-black text-slate-800 flex items-center gap-3">
          <i class="fas fa-hand-holding-heart text-indigo-600"></i>
          督導戰情室：賦能顧問版
        </h1>
        <p class="text-slate-500 text-sm mt-1">
          深度洞察｜溫暖支持｜攜手成交
        </p>
      </div>

      <div class="flex items-center bg-white shadow-sm border border-indigo-100 rounded-full px-4 py-2 gap-3 w-full md:w-auto">
        <i class="fas fa-key text-indigo-300 text-sm"></i>
        <input
          type="password"
          id="apiKey"
          placeholder="輸入 Gemini API Key 啟動神隊友"
          class="text-sm outline-none w-full md:w-64 placeholder-slate-300 text-slate-600"
        />
      </div>
    </header>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      
      <!-- Left: Input Section -->
      <div class="lg:col-span-4 space-y-4">
        <div class="bg-white rounded-2xl border border-indigo-50 p-5 card-shadow relative overflow-hidden">
          <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
          <h2 class="text-sm font-bold text-slate-800 mb-4 flex items-center gap-2">
            <i class="fas fa-pen-nib text-indigo-500"></i> 讓我們開始分析吧！
          </h2>
          
          <div class="space-y-3">
            <div>
              <label class="block text-xs font-bold text-slate-400 mb-1">個案姓名</label>
              <input type="text" id="userName" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-all" placeholder="例如：王大明">
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-xs font-bold text-slate-400 mb-1">左耳聽力</label>
                <select id="leftEar" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-2 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    <option value="未檢測/不明">未檢測</option>
                    <option value="正常 (Normal)">正常</option>
                    <option value="輕度 (Mild)">輕度</option>
                    <option value="中度 (Moderate)">中度</option>
                    <option value="中重度 (Moderately Severe)">中重度</option>
                    <option value="重度 (Severe)">重度</option>
                    <option value="極重度 (Profound)">極重度</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-bold text-slate-400 mb-1">右耳聽力</label>
                <select id="rightEar" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-2 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    <option value="未檢測/不明">未檢測</option>
                    <option value="正常 (Normal)">正常</option>
                    <option value="輕度 (Mild)">輕度</option>
                    <option value="中度 (Moderate)">中度</option>
                    <option value="中重度 (Moderately Severe)">中重度</option>
                    <option value="重度 (Severe)">重度</option>
                    <option value="極重度 (Profound)">極重度</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-xs font-bold text-slate-400 mb-1">今天的服務日誌</label>
              <textarea
                id="logInput"
                class="w-full h-[280px] p-4 bg-slate-50 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 text-sm leading-relaxed placeholder-slate-400 resize-none"
                placeholder="請把今天發生的故事告訴我...
客戶有什麼顧慮？家屬支持嗎？
只要貼上來，我幫你找出成交機會點！"
            ></textarea>
            </div>
          </div>

          <div class="flex gap-2 mt-4">
            <button
              onclick="analyzeLog()"
              id="analyzeBtn"
              class="btn flex-1 bg-gradient-to-r from-slate-800 to-slate-900 hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3.5 rounded-xl shadow-lg flex items-center justify-center gap-2"
            >
              <i class="fas fa-wand-magic-sparkles text-yellow-300"></i> 獲得賦能建議
            </button>
            <button
              onclick="loadDemo()"
              class="btn bg-white hover:bg-slate-50 border border-slate-200 text-slate-500 py-3.5 px-3.5 rounded-xl shadow-sm"
              title="載入範例"
            >
              <i class="fas fa-flask"></i>
            </button>
          </div>
        </div>

        <div id="statusInfo" class="hidden bg-white/80 backdrop-blur border border-indigo-100 p-6 rounded-2xl text-indigo-600 text-sm font-bold flex flex-col items-center justify-center gap-2 text-center shadow-lg">
          <i class="fas fa-circle-notch fa-spin text-2xl"></i>
          <span>正在為您整理思緒與策略...<br><span class="text-xs font-normal text-slate-500">深呼吸，您今天已經做得很棒了！</span></span>
        </div>
      </div>

      <!-- Right: Analysis Result -->
      <div class="lg:col-span-8">
        <div id="welcomeScreen" class="h-full min-h-[400px] flex flex-col items-center justify-center bg-white rounded-2xl border border-dashed border-slate-200 text-center p-8">
          <div class="w-20 h-20 bg-indigo-50 rounded-full flex items-center justify-center mb-4 text-indigo-300">
            <i class="fas fa-lightbulb text-4xl"></i>
          </div>
          <h3 class="text-slate-700 font-bold text-lg">準備好迎接下一步了嗎？</h3>
          <p class="text-slate-400 text-sm mt-2 max-w-sm leading-relaxed">
            輸入日誌後，我將以世界級顧問的視野，為您提供：<br>
            <span class="font-bold text-indigo-500">精準商機判斷</span>、<span class="font-bold text-indigo-500">心理學成交心法</span>，以及<span class="font-bold text-indigo-500">明確的電話追蹤指引</span>。
          </p>
        </div>

        <div id="analysisResult" class="hidden space-y-6">
            <!-- Content will be injected here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // =======================
    // Global state
    // =======================
    let lastResult = null;

    // =======================
    // Demo
    // =======================
    function loadDemo() {
      document.getElementById('userName').value = "陳阿姨";
      document.getElementById('leftEar').value = "中度 (Moderate)";
      document.getElementById('rightEar').value = "中重度 (Moderately Severe)";

      const demo = `
女兒陪同來的，感覺女兒很孝順但很忙，一直看手機。阿姨說最近打麻將都聽不到朋友碰什麼牌，很困擾。
現場做了聽力檢查，但沒有做REM。阿姨試聽後覺得聲音很亮 (覺得有點不習慣)，可是女兒覺得太貴了，說要回家跟哥哥討論一下。
我有跟她說這個有藍牙功能，但阿姨好像不太會用手機。
      `.trim();
      document.getElementById('logInput').value = demo;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // =======================
    // Core: Analyze
    // =======================
    async function analyzeLog() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const userName = document.getElementById('userName').value.trim() || "用戶";
      const leftEar = document.getElementById('leftEar').value;
      const rightEar = document.getElementById('rightEar').value;
      const logInput = document.getElementById('logInput').value.trim();
      
      const btn = document.getElementById('analyzeBtn');
      const status = document.getElementById('statusInfo');
      const resultDiv = document.getElementById('analysisResult');
      const welcome = document.getElementById('welcomeScreen');

      if (!apiKey) { alert('請先輸入 Gemini API Key。'); return; }
      if (!logInput) { alert('請貼上日誌內容。'); return; }

      btn.disabled = true;
      status.classList.remove('hidden');
      welcome.classList.add('hidden');
      resultDiv.classList.add('hidden');
      resultDiv.innerHTML = '';
      
      const promptText = `
【個案基本資料】
用戶名：${userName}
左耳聽損：${leftEar}
右耳聽損：${rightEar}

【工作日誌內容】
${logInput}
      `.trim();

      const systemPrompt = `
你是一位具遠見、思維清晰、具有高度智慧的「商業顧問導師」。
你擁有世界級商業諮詢公司（如 McKinsey, BCG）的深度經驗，同時對【視力、聽力、睡眠、保健食品】等健康產業有深厚的洞察。

請注意：**你的角色是「賦能者 (Enabler)」**。
雖然你的分析邏輯必須嚴謹（像一位嚴師），但你給予回饋的語氣必須充滿**支持、鼓勵與同理心**（像一位教練）。
你的目標不是批判同仁做得不好，而是讓他們看到「原來只要這樣調整，我就能成交」，提升他們的執行意願。

【核心判斷邏輯 - 請嚴格執行】

1.  **商機評級 (Opportunity Grade)**：
    * **S級**：剛需強 + 決策者支持 + 預算足。
    * **A級**：剛需強 + 意願高，僅需排除小異議。
    * **B級**：有需求但動機弱，或受價格/家屬阻礙 (最常見)。
    * **C級**：無自覺、排斥、純比價。

2.  **產品策略 (Oticon Intent 系列 - 依據原廠資料詳細分析)**：
    * **4D 感測技術**：Intent 1 與 Intent 2 搭載。相較於 Real 系列多提供 **5dB** 信噪比。若用戶在吵雜環境（如餐廳、聚會）有困擾，**必須** 推薦 Intent 1 或 2，並強調 4D 感測能解決「聽得到聽不清」的痛點。Intent 3 **沒有** 4D 感測，僅適合安靜環境。
    * **降噪等級 (Neural Noise Suppression)**：
        * **Intent 1**：困難環境降噪 **12dB** / 簡易環境 **6dB**。適合極度吵雜、對聲音細節要求高者。
        * **Intent 2**：困難環境降噪 **10dB** / 簡易環境 **4dB**。適合需要吵雜環境溝通，CP值高。
        * **Intent 3**：困難環境降噪 **8dB** / 簡易環境 **2dB**。適合居家、生活單純者。
    * **瞬響聲穩定器 (Sudden Sound Stabilizer)**：
        * **Intent 1**：最多消除 **30dB** (6 Configs)。適合對突發大聲（如關門聲、餐具聲）敏感、怕嚇到的用戶。
        * **Intent 2**：最多消除 **25dB** (5 Configs)。
        * **Intent 3**：最多消除 **20dB** (4 Configs)。
    * **頻寬 (Fitting Bandwidth)**：
        * **Intent 1**：**10 kHz**。高頻線索多，定位佳，聲音細節豐富（適合愛聽音樂者）。
        * **Intent 2/3**：**8 kHz**。
    * **音質調整建議**：若音質不習慣且聽力非重度，務必建議施測 **YOUMATIC**。

3.  **【關鍵任務】：24h / 7d / 14d 追蹤計畫 (務必全都以「電話」為主)**：
    * **24h**：降低焦慮、重申價值。**務必致電**關心佩戴第一天的感受。
    * **7d**：解決初期異議，確認習慣。**務必致電**詢問具體場景的改善。
    * **14d**：深度連結，創造新契機。**務必致電**維繫關係，若未購則邀約回店體驗新方案。
    * *簡訊僅作為電話未接通時的備案。*

4.  **簡訊模板 (務必產出 3 則)**：
    * **第一則【正式官方版】**：開頭固定為「【科林助聽器】親愛的${userName}貴賓，您好！」。
    * 另外提供兩則【溫暖個人版】，語氣親切像朋友。

【輸出 JSON 結構】
1. **consultant_insight**: 顧問的洞察點評 (請以「肯定現有努力 + 點出突破口」的方式撰寫，語氣要溫暖有力)。
2. **encouragement_quote**: 一句激勵人心的金句，讓同仁看完充滿力量。
3. **sales_strategy_focus**: 下次接觸的 3 個戰略重點 (包含心理學原理)。
4. **cases**: 個案詳情
    - id
    - opportunity_grade (S/A/B/C) 與 **評級理由(請客觀分析阻礙，但結尾要給予信心)**
    - product_suggestion (產品建議與理由，**請引用上述 Intent 規格數據做為佐證**)
    - followup_plan_detailed (結構化追蹤)
        - within_24h: { "phone_focus": "...", "sms_backup": "..." }
        - within_7d: { "phone_focus": "...", "sms_backup": "..." }
        - within_14d: { "phone_focus": "...", "sms_backup": "..." }
5. **sms_templates**: 3 則簡訊 (1則正式，2則個人)。

【輸出範例 (JSON)】
{
  "consultant_insight": "...",
  "encouragement_quote": "...",
  "sales_strategy_focus": ["...", "..."],
  "cases": [
    {
      "case_id": "...",
      "opportunity_grade": "B",
      "opportunity_reason": "...",
      "product_suggestion": "考量用戶常打麻將（吵雜環境），且對突發麻將聲敏感，強烈建議維持 **Intent 1**。因為它具備 **4D 感測技術** (比 Real 多 5dB 信噪比) 能在牌桌上聽清語音，且 **30dB 瞬響聲抑制** 能有效過濾洗牌噪音，這是 Intent 3 (無4D/僅20dB抑制) 做不到的。",
      "followup_plan_detailed": {
        "within_24h": { "phone_focus": "致電重點：先不談買賣，純粹關心...", "sms_backup": "..." },
        ...
      }
    }
  ],
  "sms_templates": [
    { "scenario": "正式關懷", "template": "..." }
  ]
}
      `.trim();

      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${encodeURIComponent(apiKey)}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{
                parts: [{ text: promptText }]
              }],
              systemInstruction: { parts: [{ text: systemPrompt }] },
              generationConfig: {
                responseMimeType: "application/json",
                temperature: 0.4
              }
            })
          }
        );

        const data = await response.json();
        const raw = data?.candidates?.[0]?.content?.parts?.[0]?.text;
        if (!raw) throw new Error("模型未回傳可解析內容");

        let result;
        let cleanText = raw.replace(/```json/gi, '').replace(/```/g, '').trim();
        cleanText = cleanText.replace(/,\s*([\]}])/g, '$1');

        try {
          result = JSON.parse(cleanText);
        } catch (e) {
          const first = cleanText.indexOf('{');
          const last = cleanText.lastIndexOf('}');
          if (first >= 0 && last >= 0 && last > first) {
              result = JSON.parse(cleanText.substring(first, last + 1));
          } else throw e;
        }

        lastResult = result;
        renderReport(result);

      } catch (error) {
        console.error(error);
        alert('分析失敗：請檢查網路或 API Key。');
      } finally {
        btn.disabled = false;
        status.classList.add('hidden');
        resultDiv.classList.remove('hidden');
      }
    }

    // =======================
    // Render
    // =======================
    function renderReport(data) {
        const container = document.getElementById('analysisResult');
        const insight = data?.consultant_insight || "正在為您整理思緒...";
        const quote = data?.encouragement_quote || "相信自己，你能做到！";
        const focus = data?.sales_strategy_focus || [];
        const cases = data?.cases || [];
        const sms = data?.sms_templates || [];

        let html = '';

        // 1. Follow-up Plan (Priority)
        html += `
          <div class="space-y-6">
            ${cases.map((c, idx) => `
                <div class="bg-white rounded-2xl border border-indigo-50 shadow-xl overflow-hidden animate-fade-in">
                    <div class="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="w-8 h-8 bg-white border border-slate-200 rounded-full flex items-center justify-center font-bold text-slate-600 text-sm shadow-sm">${idx+1}</span>
                            <h3 class="font-black text-slate-800 text-lg">${escapeHtml(c.case_id)} 追蹤計畫</h3>
                        </div>
                    </div>
                    <div class="p-6">
                        <h4 class="text-sm font-bold text-slate-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-phone-volume text-emerald-500"></i> 電話關懷指引 (致電重點)
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${renderPlanCard('24H 黃金溫溫期', c.followup_plan_detailed?.within_24h, 'border-emerald-100 bg-emerald-50/30')}
                            ${renderPlanCard('7D 習慣養成期', c.followup_plan_detailed?.within_7d, 'border-slate-200 bg-white')}
                            ${renderPlanCard('14D 關係深耕期', c.followup_plan_detailed?.within_14d, 'border-slate-200 bg-white')}
                        </div>
                    </div>
                </div>
            `).join('')}
          </div>
        `;

        // 2. SMS Templates
        if (sms.length > 0) {
            html += `
              <div class="bg-white rounded-2xl border border-indigo-50 p-6 card-shadow animate-fade-in mt-6" style="animation-delay: 0.1s">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-comment-dots text-indigo-500"></i> 簡訊備案 (致電未接時使用)
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${sms.map(t => `
                        <div class="bg-white rounded-xl p-4 border border-slate-200 relative group cursor-pointer hover:border-indigo-400 hover:shadow-md transition-all" 
                             data-sms="${escapeHtml(t.template)}"
                             onclick="copyTextToClipboard(this.dataset.sms)">
                            <div class="absolute top-3 right-3 text-indigo-500 opacity-0 group-hover:opacity-100 transition-opacity transform group-hover:scale-110">
                                <i class="fas fa-copy"></i>
                            </div>
                            <div class="text-xs font-bold text-indigo-600 mb-2 uppercase tracking-wide bg-indigo-50 inline-block px-2 py-0.5 rounded">${escapeHtml(t.scenario)}</div>
                            <p class="text-sm text-slate-600 whitespace-pre-wrap leading-relaxed">${escapeHtml(t.template)}</p>
                        </div>
                    `).join('')}
                </div>
              </div>
            `;
        }

        // 3. Strategic Focus
        if (focus.length > 0) {
            html += `
              <div class="bg-white rounded-2xl border border-indigo-50 p-6 card-shadow animate-fade-in mt-6" style="animation-delay: 0.2s">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-compass text-red-500"></i> 下一步，我們這樣做會更好
                </h3>
                <ul class="space-y-3">
                    ${focus.map(item => `
                        <li class="flex items-start gap-3 text-sm text-slate-700 bg-slate-50 p-3 rounded-xl border border-slate-100 hover:border-red-200 transition-colors">
                            <i class="fas fa-check-circle text-red-400 mt-0.5"></i>
                            <span class="font-medium">${escapeHtml(item)}</span>
                        </li>
                    `).join('')}
                </ul>
              </div>
            `;
        }

        // 4. Consultant Insight & Grade (Summary)
        html += `
          <div class="mt-6 space-y-6 animate-fade-in" style="animation-delay: 0.3s">
             <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-2xl p-8 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full -mr-10 -mt-10"></div>
                <div class="flex items-start gap-5 relative z-10">
                    <div class="bg-white/10 p-3 rounded-2xl backdrop-blur-sm">
                        <i class="fas fa-crown text-yellow-400 text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-xl mb-3">顧問導師的戰略總結</h2>
                        <p class="text-slate-200 text-sm leading-relaxed font-medium tracking-wide">${escapeHtml(insight)}</p>
                        <div class="mt-4 pt-4 border-t border-white/10 flex items-center gap-2 text-yellow-300 text-sm font-bold">
                            <i class="fas fa-quote-left"></i>
                            <span>${escapeHtml(quote)}</span>
                        </div>
                    </div>
                </div>
            </div>

            ${cases.map(c => {
                const grade = c.opportunity_grade || '?';
                const gradeColor = grade === 'S' || grade === 'A' ? 'bg-emerald-100 text-emerald-700' : grade === 'B' ? 'bg-indigo-100 text-indigo-700' : 'bg-slate-100 text-slate-600';
                
                return `
                <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden card-shadow">
                    <div class="bg-slate-50/50 px-6 py-4 border-b border-slate-100 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">商機總結</span>
                            <span class="px-3 py-1 rounded-lg font-black text-sm ${gradeColor} shadow-sm">${grade} 級</span>
                        </div>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-xs font-bold text-slate-400 uppercase mb-2 flex items-center gap-1"><i class="fas fa-search"></i> 機會點分析</h4>
                            <p class="text-sm text-slate-700 leading-relaxed font-medium bg-slate-50 p-3 rounded-xl border border-slate-100">${escapeHtml(c.opportunity_reason)}</p>
                        </div>
                        <div>
                            <h4 class="text-xs font-bold text-indigo-400 uppercase mb-2 flex items-center gap-1"><i class="fas fa-gift"></i> 服務與專業建議</h4>
                            <p class="text-sm text-indigo-800 font-medium leading-relaxed bg-indigo-50 p-3 rounded-xl border border-indigo-100">${escapeHtml(c.product_suggestion)}</p>
                        </div>
                    </div>
                </div>
                `;
            }).join('')}
          </div>
        `;

        container.innerHTML = html;
    }

    function renderPlanCard(title, plan, extraClass = '') {
        if (!plan) return '';
        return `
            <div class="border rounded-xl p-4 flex flex-col h-full hover:shadow-sm transition-shadow ${extraClass}">
                <div class="text-xs font-black text-slate-400 uppercase mb-3 tracking-wider pb-2 border-b border-slate-100/50 flex justify-between items-center">
                    ${title}
                </div>
                
                <div class="mb-3 flex-1">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                        <span class="text-xs font-bold text-emerald-700">致電重點</span>
                    </div>
                    <p class="text-sm text-slate-700 font-bold leading-snug">${escapeHtml(plan.phone_focus)}</p>
                </div>

                <div class="pt-2 border-t border-slate-100/50">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-message text-slate-300 text-xs"></i>
                        <span class="text-xs font-bold text-slate-400">簡訊備案</span>
                    </div>
                    <p class="text-xs text-slate-500 leading-snug">${escapeHtml(plan.sms_backup)}</p>
                </div>
            </div>
        `;
    }

    // =======================
    // Utilities
    // =======================
    function escapeHtml(str) {
      if (str === null || str === undefined) return '';
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }
    
    function copyTextToClipboard(text) {
        if (!text) return;
        navigator.clipboard.writeText(text).then(() => {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-5 right-5 bg-slate-800 text-white px-4 py-2.5 rounded-full text-sm font-bold shadow-lg animate-bounce z-50 flex items-center gap-2';
            toast.innerHTML = '<i class="fas fa-check-circle text-emerald-400 text-lg"></i> 已複製簡訊內容';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }).catch(() => alert('複製失敗'));
    }
  </script>
</body>
</html>